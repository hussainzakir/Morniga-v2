<div 
  (click)="closeModal()"
  class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-70 backdrop-blur-sm transition-opacity duration-300 ease-in-out"
  [class.opacity-100]="isVisible()"
  [class.opacity-0]="!isVisible()">
  
  <div 
    (click)="onModalClick($event)"
    class="bg-gray-900 w-11/12 max-w-4xl rounded-xl shadow-2xl overflow-hidden transform transition-all duration-300 ease-in-out flex"
    [class.scale-100]="isVisible()"
    [class.opacity-100]="isVisible()"
    [class.scale-95]="!isVisible()"
    [class.opacity-0]="!isVisible()">

    <!-- Left Panel with SVGs -->
    <div class="hidden md:block w-1/2 bg-gray-800 p-12 relative overflow-hidden">
      <!-- Login SVG Panel -->
      <div class="absolute inset-0 transition-all duration-700 ease-in-out"
           [class.opacity-100]="view() === 'login'"
           [class.translate-x-0]="view() === 'login'"
           [class.opacity-0]="view() === 'register'"
           [class.-translate-x-full]="view() === 'register'">
        <div class="absolute inset-0 flex flex-col items-center justify-center p-8 text-center text-white animate-float">
          <svg class="w-48 h-48" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g class="transition-colors duration-300 text-green-400 dark:text-gray-300">
              <path class="text-green-500/10 dark:text-gray-500/10" d="M100 180C144.183 180 180 144.183 180 100C180 55.8172 144.183 20 100 20C55.8172 20 20 55.8172 20 100C20 144.183 55.8172 180 100 180Z" fill="currentColor"/>
              <path d="M129.5 70.5C129.5 86.8513 115.851 100.5 99.5 100.5C83.1487 100.5 69.5 86.8513 69.5 70.5C69.5 54.1487 83.1487 40.5 99.5 40.5C115.851 40.5 129.5 54.1487 129.5 70.5Z" stroke="currentColor" stroke-width="4"/>
              <path d="M50 160C50 132.386 72.3858 110 100 110C127.614 110 150 132.386 150 160V170H50V160Z" stroke="currentColor" stroke-width="4"/>
            </g>
          </svg>
          <h2 class="text-2xl font-bold mt-6">Welcome Back</h2>
          <p class="mt-2 text-gray-300">Sign in to continue your journey with Mega Moringa.</p>
        </div>
      </div>
       <!-- Register SVG Panel -->
      <div class="absolute inset-0 transition-all duration-700 ease-in-out"
           [class.opacity-100]="view() === 'register'"
           [class.translate-x-0]="view() === 'register'"
           [class.opacity-0]="view() === 'login'"
           [class.translate-x-full]="view() === 'login'">
        <div class="absolute inset-0 flex flex-col items-center justify-center p-8 text-center text-white animate-pulse-grow">
          <svg class="w-48 h-48" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g class="transition-colors duration-300 text-green-400 dark:text-gray-300">
              <path class="text-green-500/10 dark:text-gray-500/10" d="M100 180C144.183 180 180 144.183 180 100C180 55.8172 144.183 20 100 20C55.8172 20 20 55.8172 20 100C20 144.183 55.8172 180 100 180Z" fill="currentColor"/>
              <path d="M70 70H130V130H70V70Z" stroke="currentColor" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M100 70V130" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
              <path d="M130 100H70" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
            </g>
          </svg>
          <h2 class="text-2xl font-bold mt-6">Create an Account</h2>
          <p class="mt-2 text-gray-300">Join the family and unlock the full potential of moringa.</p>
        </div>
      </div>
    </div>

    <!-- Right Panel with Forms -->
    <div class="w-full md:w-1/2 p-8 md:p-12 flex flex-col justify-center relative overflow-hidden min-h-[550px]">
      <button (click)="closeModal()" class="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors z-10">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
      </button>

      <!-- Login Form -->
      <div class="absolute inset-0 p-8 md:p-12 flex flex-col justify-center transition-all duration-500 ease-in-out"
           [class.opacity-100]="view() === 'login'"
           [class.translate-x-0]="view() === 'login'"
           [class.opacity-0]="view() === 'register'"
           [class.-translate-x-8]="view() === 'register'"
           [class.invisible]="view() === 'register'">
        <form [formGroup]="loginForm" (ngSubmit)="onLoginSubmit()" novalidate>
          <h2 class="text-3xl font-bold text-white mb-6">Login</h2>
          <div class="space-y-4">
            <div>
              <label for="login-email" class="block text-sm font-medium text-gray-300">Email</label>
              <input type="email" id="login-email" formControlName="email" 
                     class="mt-1 block w-full bg-gray-800 border border-gray-700 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-white"
                     [class.shake]="loginForm.get('email')?.invalid && loginForm.get('email')?.touched">
              @if (loginForm.get('email')?.invalid && (loginForm.get('email')?.dirty || loginForm.get('email')?.touched)) {
                <p class="text-red-400 text-xs mt-1">Please enter a valid email.</p>
              }
            </div>
            <div>
              <label for="login-password" class="block text-sm font-medium text-gray-300">Password</label>
              <input type="password" id="login-password" formControlName="password" 
                     class="mt-1 block w-full bg-gray-800 border border-gray-700 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-white"
                     [class.shake]="loginForm.get('password')?.invalid && loginForm.get('password')?.touched">
              @if (loginForm.get('password')?.invalid && (loginForm.get('password')?.dirty || loginForm.get('password')?.touched)) {
                <p class="text-red-400 text-xs mt-1">Password must be at least 8 characters.</p>
              }
            </div>
          </div>
          <button type="submit" class="w-full mt-6 bg-green-600 dark:bg-gray-200 text-white dark:text-black font-bold py-3 rounded-md hover:bg-green-500 dark:hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed" [disabled]="loginForm.invalid">
            Sign In
          </button>
          <p class="mt-4 text-center text-sm text-gray-400">
            Don't have an account? <button type="button" (click)="switchToRegister()" class="font-semibold text-green-400 hover:text-green-300 dark:text-gray-300 dark:hover:text-white">Sign up</button>
          </p>
        </form>
      </div>

      <!-- Register Form -->
      <div class="absolute inset-0 p-8 md:p-12 flex flex-col justify-center transition-all duration-500 ease-in-out"
           [class.opacity-100]="view() === 'register'"
           [class.translate-x-0]="view() === 'register'"
           [class.opacity-0]="view() === 'login'"
           [class.translate-x-8]="view() === 'login'"
           [class.invisible]="view() === 'login'">
        <form [formGroup]="registerForm" (ngSubmit)="onRegisterSubmit()" novalidate>
          <h2 class="text-3xl font-bold text-white mb-6">Create Account</h2>
          <div class="space-y-4">
            <div>
              <label for="register-name" class="block text-sm font-medium text-gray-300">Full Name</label>
              <input type="text" id="register-name" formControlName="name" 
                     class="mt-1 block w-full bg-gray-800 border border-gray-700 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-white"
                     [class.shake]="registerForm.get('name')?.invalid && registerForm.get('name')?.touched">
              @if (registerForm.get('name')?.invalid && (registerForm.get('name')?.dirty || registerForm.get('name')?.touched)) {
                <p class="text-red-400 text-xs mt-1">Name is required.</p>
              }
            </div>
            <div>
              <label for="register-email" class="block text-sm font-medium text-gray-300">Email</label>
              <input type="email" id="register-email" formControlName="email" 
                     class="mt-1 block w-full bg-gray-800 border border-gray-700 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-white"
                     [class.shake]="registerForm.get('email')?.invalid && registerForm.get('email')?.touched">
              @if (registerForm.get('email')?.invalid && (registerForm.get('email')?.dirty || registerForm.get('email')?.touched)) {
                <p class="text-red-400 text-xs mt-1">Please enter a valid email.</p>
              }
            </div>
            <div>
              <label for="register-password" class="block text-sm font-medium text-gray-300">Password</label>
              <input type="password" id="register-password" formControlName="password" 
                     class="mt-1 block w-full bg-gray-800 border border-gray-700 rounded-md py-2 px-3 text-white focus:outline-none focus:ring-2 focus:ring-green-500 dark:focus:ring-white"
                     [class.shake]="registerForm.get('password')?.invalid && registerForm.get('password')?.touched">
              @if (registerForm.get('password')?.invalid && (registerForm.get('password')?.dirty || registerForm.get('password')?.touched)) {
                <p class="text-red-400 text-xs mt-1">Password must be at least 8 characters.</p>
              }
            </div>
          </div>
          <button type="submit" class="w-full mt-6 bg-green-600 dark:bg-gray-200 text-white dark:text-black font-bold py-3 rounded-md hover:bg-green-500 dark:hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed" [disabled]="registerForm.invalid">
            Create Account
          </button>
          <p class="mt-4 text-center text-sm text-gray-400">
            Already have an account? <button type="button" (click)="switchToLogin()" class="font-semibold text-green-400 hover:text-green-300 dark:text-gray-300 dark:hover:text-white">Sign in</button>
          </p>
        </form>
      </div>

    </div>
  </div>
</div>
